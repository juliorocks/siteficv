<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notícias | FICV</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Main Styles -->
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/style-news.css">
    <style>
        /* Blog Post Specific Styles */
        .news-post-header {
            padding: 140px 0 60px;
            text-align: center;
            background: #0d0d0d;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .news-post-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            /* Darker overlay */
            z-index: 1;
        }

        .news-post-header .container {
            position: relative;
            z-index: 2;
        }

        .news-meta {
            color: var(--color-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            display: inline-block;
        }

        .news-title {
            color: #fff;
            font-size: 2.5rem;
            max-width: 800px;
            margin: 0 auto 20px;
            line-height: 1.2;
        }

        .news-subtitle {
            color: #ccc;
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto;
            font-weight: 300;
        }

        .news-featured-image {
            width: 100%;
            height: 500px;
            object-fit: cover;
            margin-bottom: 40px;
        }

        .news-content-wrapper {
            background: #fff;
            color: #333;
            padding: 60px 0;
        }

        .news-body {
            max-width: 800px;
            margin: 0 auto;
            font-size: 1.1rem;
            line-height: 1.8;
            color: #444;
        }

        /* WYSIWYG Content Styles */
        .news-body h2 {
            color: #1a2e3b;
            font-size: 1.8rem;
            margin: 40px 0 20px;
        }

        .news-body h3 {
            color: #1a2e3b;
            font-size: 1.5rem;
            margin: 30px 0 15px;
        }

        .news-body p {
            margin-bottom: 20px;
        }

        .news-body ul {
            list-style: disc;
            padding-left: 20px;
            margin-bottom: 20px;
        }

        .news-body ol {
            list-style: decimal;
            padding-left: 20px;
            margin-bottom: 20px;
        }

        .news-body blockquote {
            border-left: 4px solid var(--color-secondary);
            padding-left: 20px;
            font-style: italic;
            color: #666;
            margin: 30px 0;
        }

        .news-body img {
            width: 100%;
            border-radius: 8px;
            margin: 20px 0;
        }

        /* Related Section */
        .related-section {
            padding: 60px 0;
            background: #070707;
            /* Dark background */
        }
    </style>
    <link rel="icon" type="image/png" href="/favicon.png" />
</head>

<body>

    <!-- Header (Shared) -->
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="container top-bar-inner">
            <div class="top-bar-left">
                <p id="topbar_text_left" class="text-desktop">Formando líderes que transformam o mundo</p>
                <p class="text-mobile" style="display:none">Líderes que transformam o mundo</p>
            </div>
            <div class="top-bar-right">
                <div class="mobile-trigger" id="mobileTrigger">
                    <span style="text-decoration: underline;">Grupo Cidade Viva</span> <i class="fas fa-caret-down"></i>
                </div>
                <div class="top-bar-links" id="topBarLinks">
                    <a id="topbar_link_igreja" href="https://cidadeviva.org" target="_blank">Igreja</a>
                    <a id="topbar_link_faculdade" href="/" class="active">Faculdade</a>
                    <a id="topbar_link_academy" href="https://cidadeviva.education" target="_blank">Academy</a>
                    <a id="topbar_link_education" href="https://cidadeviva.education" target="_blank">Education</a>
                    <a id="topbar_link_godstock" href="https://godstock.cidadeviva.org" target="_blank">Godstock</a>
                </div>
            </div>
        </div>
    </div>

    <header id="main-header">
        <div class="container header-container">
            <div class="logo-wrapper">
                <a href="/" class="logo">
                    <img src="https://cursos.ficv.edu.br/wp-content/uploads/2025/02/logo-ficv.png" alt="FICV Logo">
                </a>
            </div>

            <div class="header-right">
                <!-- Action Buttons -->
                <div class="header-buttons">
                    <div class="dropdown-container">
                        <a href="#" class="btn btn-outline" style="font-size: 0.8rem; padding: 6px 12px;"><i
                                class="fas fa-graduation-cap"></i> Já sou Aluno</a>
                        <div class="dropdown-menu">
                            <div class="dropdown-menu-content">
                                <a href="#" class="dropdown-item" data-cms-href="header_student_ava_url"
                                    target="_blank">Ambiente Virtual</a>
                                <a href="#" class="dropdown-item" data-cms-href="header_student_portal_url"
                                    target="_blank">Portal do Aluno</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Menu Icon Trigger -->
                <button class="menu-trigger" aria-label="Abrir menu">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Offcanvas Menu (Shared) -->
    <div class="offcanvas-menu">
        <button class="close-menu">&times;</button>

        <div class="offcanvas-content">
            <!-- Section: Cursos -->
            <div class="offcanvas-section">
                <div class="offcanvas-header">
                    <span class="small-title">Nossos</span>
                    <h2 class="large-title">Cursos</h2>
                </div>
                <nav>
                    <ul>
                        <li><a href="/cursos?type=graduacao">Graduação</a></li>
                        <li><a href="/cursos?type=graduacao-ead">Graduação EAD</a></li>
                        <li><a href="/cursos?type=pos-graduacao">Pós-Graduação</a></li>
                        <li><a href="/cursos?type=livres">Cursos Livres</a></li>
                        <li><a href="/cursos">Ver Todos</a></li>
                    </ul>
                </nav>
            </div>

            <!-- Section: Institucional -->
            <div class="offcanvas-section">
                <div class="offcanvas-header">
                    <span class="small-title">Sobre nós</span>
                    <h2 class="large-title">Institucional</h2>
                </div>
                <nav>
                    <ul>
                        <li><a href="/quem-somos">Quem somos</a></li>
                        <li><a href="/estrutura">Estrutura</a></li>
                        <li><a href="https://ficv.i10bibliotecas.com.br/" target="_blank"
                                data-cms-href="nav_biblioteca_url">Biblioteca</a></li>
                        <li><a href="https://ficv.i10bibliotecas.com.br/ri" target="_blank"
                                data-cms-href="nav_repositorio_url">Repositório Institucional</a></li>
                        <li><a href="/npj">Núcleo de Prática Jurídica</a></li>
                        <li><a href="/noticias">Notícias</a></li>

                        <li><a href="https://diplomas.somosb4.com.br/validar" target="_blank"
                                data-cms-href="nav_validacao_diploma_url">Validação de Diploma</a></li>
                        <li><a href="/fale-conosco">Fale conosco</a></li>
                    </ul>
                </nav>
            </div>

            <!-- Section: Revista -->
            <div class="offcanvas-section">
                <div class="offcanvas-header">
                    <span class="small-title">Revista Acadêmica</span>
                    <h2 class="large-title">Summae Sapientiae</h2>
                </div>
                <nav>
                    <ul>
                        <li><a href="https://periodicos.ficv.edu.br/summaesapientiae" target="_blank"
                                data-cms-href="nav_revista_url">Acesse nossa Revista</a></li>
                    </ul>
                </nav>
            </div>

            <!-- Section: Redes Sociais -->
            <div class="offcanvas-section">
                <div class="offcanvas-header">
                    <span class="small-title">Siga-nos nas</span>
                    <h2 class="large-title">Redes Sociais</h2>
                </div>
                <div class="offcanvas-socials">
                    <a href="#" class="social-icon" data-cms-href="social_instagram" target="_blank"><i
                            class="fab fa-instagram"></i></a>
                    <a href="#" class="social-icon" data-cms-href="social_facebook" target="_blank"><i
                            class="fab fa-facebook"></i></a>
                    <a href="#" class="social-icon" data-cms-href="social_youtube" target="_blank"><i
                            class="fab fa-youtube"></i></a>
                    <a href="#" class="social-icon" data-cms-href="social_linkedin" target="_blank"><i
                            class="fab fa-linkedin"></i></a>
                </div>
            </div>
        </div>
    </div>

    <!-- LOADER -->
    <div id="page-loader"
        style="position:fixed; top:0; left:0; width:100%; height:100vh; background:#000; z-index:9999; display:flex; justify-content:center; align-items:center;">
        <i class="fas fa-spinner fa-spin fa-3x" style="color:var(--color-primary);"></i>
    </div>

    <!-- MAIN CONTENT -->
    <main id="news-main" style="display:none;">

        <!-- Header Info -->
        <section class="news-post-header">
            <div class="container">
                <span class="news-meta" id="post-meta">CATEGORIA &bull; DATA</span>
                <h1 class="news-title" id="post-title">Título da Notícia</h1>
                <p class="news-subtitle" id="post-subtitle">Subtítulo da notícia carregando...</p>
            </div>
        </section>

        <!-- Content -->
        <section class="news-content-wrapper">
            <div class="container">
                <img src="" class="news-featured-image" id="post-image" alt="Imagem destaque">

                <div class="news-body" id="post-body">
                    <!-- HTML Content -->
                </div>

                <div style="max-width:800px; margin: 40px auto 0; padding-top:20px; border-top:1px solid #eee;">
                    <a href="/noticias" style="color:var(--color-secondary); font-weight:600;"><i
                            class="fas fa-arrow-left"></i> Voltar para Notícias</a>
                </div>
            </div>
        </section>

        <!-- Related Posts -->
        <section class="related-section" id="related-section" style="display:none;">
            <div class="container">
                <h3 style="color:#ffffff; margin-bottom:30px; font-weight:700;">Relacionados</h3>
                <div class="news-grid" id="related-grid">
                    <!-- Related Items -->
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer id="contato">
        <!-- Social Media Row (Ante-Rodapé) -->
        <div class="container footer-social-row"
            style="padding-bottom: 30px; margin-bottom: 40px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center;">
            <span style="color: #fff; font-size: 1.1rem; font-weight: 500;">Siga-nos nas redes:</span>
            <a href="#" id="social-instagram" data-cms-href="social_instagram" target="_blank" class="social-icon"><i
                    class="fab fa-instagram"></i></a>
            <a href="#" id="social-facebook" data-cms-href="social_facebook" target="_blank" class="social-icon"><i
                    class="fab fa-facebook"></i></a>
            <a href="#" id="social-youtube" data-cms-href="social_youtube" target="_blank" class="social-icon"><i
                    class="fab fa-youtube"></i></a>
            <a href="#" id="social-linkedin" data-cms-href="social_linkedin" target="_blank" class="social-icon"><i
                    class="fab fa-linkedin"></i></a>
        </div>

        <div class="container footer-grid">
            <div class="footer-col footer-col-logo">
                <img src="https://cursos.ficv.edu.br/wp-content/uploads/2025/02/logo-ficv.png" alt="FICV Logo Footer"
                    style="filter: brightness(0) invert(1); opacity: 0.7; width: 150px; margin-bottom: 20px;">
                <p id="footer-desc" data-cms-key="footer_desc">Faculdade Internacional Cidade Viva. Transformando vidas
                    através
                    da educação de excelência
                    com princípios
                    cristãos.</p>
            </div>
            <div class="footer-col footer-col-links">
                <h3>Links Rápidos</h3>
                <ul>
                    <li><a href="/">Início</a></li>
                    <li><a href="/cursos">Cursos</a></li>
                    <li><a href="#">Vestibular</a></li>
                    <li><a href="#">Portal do Aluno</a></li>
                </ul>
            </div>
            <div class="footer-col footer-col-contact">
                <h3>Contato</h3>
                <p><i class="fas fa-phone"></i> <span id="footer-phone" data-cms-key="contact_phone">(83)
                        3041-7471</span></p>
                <p><i class="fas fa-envelope"></i> <span id="footer-email"
                        data-cms-key="contact_email">contato@ficv.edu.br</span></p>
                <p><i class="fas fa-map-marker-alt"></i> <span id="footer-address" data-cms-key="contact_address">João
                        Pessoa -
                        PB</span></p>
            </div>
            <!-- MEC Seal Column -->
            <div class="footer-col footer-col-mec"
                style="display: flex; flex-direction: column; align-items: flex-end; text-align: right;">
                <a href="https://emec.mec.gov.br/emec/consulta-cadastro/detalhamento/d96957f455f6405d14c6542552b0f6eb/MjEyMjQ="
                    target="_blank" id="footer-emec-link" data-cms-href="footer_emec_url">
                    <img src="/images/emec-qrcode-v2.png" alt="Consulta e-MEC" style="width: 100px; border-radius: 8px;"
                        id="footer-emec-img">
                </a>
            </div>
        </div>
        <div class="footer-bottom center">
            <p id="footer-copyright" data-cms-key="footer_copyright">&copy; 2025 FICV - Todos os direitos reservados.
            </p>
        </div>
    </footer>

    <!-- Logic -->
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
        const SUPABASE_URL = 'https://zvfotmlfwglwysqbximn.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2Zm90bWxmd2dsd3lzcWJ4aW1uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5NzA2MjEsImV4cCI6MjA4MTU0NjYyMX0.vUTtOAi8bXmDv5t-T0v7Nm1GLPdk1yozLZW-YLn8nG8';
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        const params = new URLSearchParams(window.location.search);
        let slug = params.get('s');

        // Fetch All CMS Content (Header, Footer, etc)
        async function loadCMSContent() {
            const { data } = await supabase.from('site_content').select('item_key, content_value');
            if (data) {
                const content = {};
                data.forEach(item => content[item.item_key] = item.content_value);

                // Apply keys
                document.querySelectorAll('[data-cms-key]').forEach(el => {
                    const key = el.getAttribute('data-cms-key');
                    if (content[key]) {
                        if (el.tagName.toLowerCase() === 'img') el.src = content[key];
                        else if (el.tagName.toLowerCase() === 'div' && el.style.backgroundImage) el.style.backgroundImage = `url('${content[key]}')`;
                        else el.innerText = content[key];
                    }
                });

                // Apply hrefs
                document.querySelectorAll('[data-cms-href]').forEach(el => {
                    const key = el.getAttribute('data-cms-href');
                    if (content[key]) el.href = content[key];
                });
            }
        }
        loadCMSContent();

        // Fallback for pretty urls /news/slug
        if (!slug) {
            const pathSegments = window.location.pathname.split('/').filter(s => s.length > 0 && s !== 'news');
            if (pathSegments.length >= 1) {
                slug = pathSegments[pathSegments.length - 1];
            }
        }

        if (!slug) window.location.href = '/';

        async function loadPost() {
            try {
                // Fetch Post + Category Name
                const { data: posts, error } = await supabase.from('news').select('*, categories(name)').eq('slug', slug);

                if (!posts || posts.length === 0) {
                    // Check if title match (legacy fallback?)
                    // Just redirect or error
                    alert('Notícia não encontrada');
                    window.location.href = '/';
                    return;
                }

                const post = posts[0];
                document.title = `${post.title} | FICV Notícias`;

                // Render Header
                const date = new Date(post.publish_date).toLocaleDateString('pt-BR');
                const catName = post.categories ? post.categories.name : 'Geral';
                document.getElementById('post-meta').innerHTML = `${catName} &bull; ${date}`;
                document.getElementById('post-title').innerText = post.title;
                document.getElementById('post-subtitle').innerText = post.subtitle || '';

                // Image
                if (post.image_url) {
                    // Set as header background
                    const header = document.querySelector('.news-post-header');
                    if (header) {
                        const bgImg = post.header_image_url && post.header_image_url.trim() !== '' ? post.header_image_url : post.image_url;
                        header.style.backgroundImage = `url('${bgImg}')`;
                    }
                    // Keep the body image as well, as requested ("também estar")
                    document.getElementById('post-image').src = post.image_url;
                } else {
                    document.getElementById('post-image').style.display = 'none';
                }

                // Body
                document.getElementById('post-body').innerHTML = post.content || '<p>Sem conteúdo.</p>';

                // Load Related
                if (post.category_id) loadRelated(post.category_id, post.id);

                document.getElementById('page-loader').style.display = 'none';
                document.getElementById('news-main').style.display = 'block';

            } catch (e) {
                console.error(e);
            }
        }

        async function loadRelated(catId, currentId) {
            const { data } = await supabase.from('news').select('*, categories(name)').eq('category_id', catId).neq('id', currentId).limit(3);

            if (data && data.length > 0) {
                document.getElementById('related-section').style.display = 'block';
                const grid = document.getElementById('related-grid');

                grid.innerHTML = data.map(item => `
                    <div class="news-card" onclick="window.location.href='/news/${item.slug}'" style="cursor:pointer;">
                        <div class="news-image">
                            <img src="${item.image_url || 'https://via.placeholder.com/400x300'}" alt="${item.title}">
                        </div>
                        <div class="news-content">
                            <div class="news-meta-small" style="font-size:0.8rem; color:#888; margin-bottom:10px;">
                                ${new Date(item.publish_date).toLocaleDateString('pt-BR')}
                            </div>
                            <h3>${item.title}</h3>
                            <span style="color:var(--color-secondary); font-weight:600; font-size:0.9rem;">Ler Mais <i class="fas fa-arrow-right"></i></span>
                        </div>
                    </div>
                 `).join('');
            }
        }

        loadPost();

        // Menu
        const menuTrigger = document.querySelector('.menu-trigger');
        const closeMenu = document.querySelector('.close-menu');
        const offcanvasMenu = document.querySelector('.offcanvas-menu');
        if (menuTrigger && offcanvasMenu) {
            menuTrigger.addEventListener('click', () => offcanvasMenu.classList.add('active'));
            if (closeMenu) closeMenu.addEventListener('click', () => offcanvasMenu.classList.remove('active'));
        }
    </script>
</body>

</html>